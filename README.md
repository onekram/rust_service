# Rust Service

## Функционал приложения
  - Добавить заказ в базу данных: __POST__ запрос по адресу /add_order с данными о заказе в формате JSON
  - Получить заказ из базы данных: __GET__ запрос по адресу /get_order/uid, где uid - идентификатор заказа

## Запуск приложения, CLI
```
cargo run -- -l --server-host <SERVER_HOST> --server-port <SERVER_PORT> --db-user <DB_USER> --db-password <DB_PASSWORD> --db-host <DB_HOST> --db-port <DB_PORT> --db-name <DB_NAME> --cache-size <CACHE_SIZE>
```
#### Информация об аргументах командной строки
```
cargo run -- --help
```

## Хранение в базе данных
- Модель логически разбивается на раздельные сущности, поэтому информация о заказе храниться в 4-х таблицах
- __payment__ хранит информацию об оплате
- __delivery__ хранит информацию о доставке
- __item__ хранит информацию о товаре (может быть несколько для одного заказа)
- __order_info__ хранит информацию о заказе (ссылается на ячейки таблицы __payment__, __delivery__)
- __order_item__ хранит информацию о связи товара и заказа (ссылкается на ячейки таблица __order__, __item__)


## Кэширование
- В качестве кэша выступает __LruCache__, состояние кэша (как и клиент базы данных) храниться как Read-Write lock структура
- Размер кеша определяется аргументом командной строки
- Успешное добавление заказа в базу данных приводит к добавлению заказа в кэш
- При получении заказа сначала будет проведена проверка на наличие заказа в кэше, в случае отсутствия, будет выполнен запрос к базе данных

## Тестирование
- В репозитории представлен скрипт __app_test.sh__, который проверяет успешность добавления и получения заказа, сверяет полученные данные с ожидаемыми
- Добавлено нагрузочное тестирование __vegeta_test.sh__
#### Запуск тестов
```
test/app_test.sh
```

```
test/vegeta_test.sh
```

## CI
- Добавлена проверка линтером и корректного выполнения тестов при push/pull request master
